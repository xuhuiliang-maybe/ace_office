{% extends "base/document_edit.html" %}

{% block self_js %}
    <script type="text/javascript">
        $('#id_attribution_dept').attr("readonly", "true");
        $('#id_one_level_dept').attr("readonly", "true");
        $('#id_attribution_dept').on('click', function (ev) {
            select_dept("#tree1", "#myDeptModal")
        });

        $('#id_one_level_dept').on('click', function (ev) {
            select_dept("#tree2", "#myDeptModal-2")
        });


        //监听新增用户选择部门
        $('#tree1').on('selected.fu.tree', function (e, result) {
            var dept_name = delHtmlTag(result.selected[0].text.replace(/\s/gi,''));
            $('#id_attribution_dept').val(dept_name);
        });
        $('#tree2').on('selected.fu.tree', function (e, result) {
            var dept_name = delHtmlTag(result.selected[0].text.replace(/\s/gi,''));
            $('#id_one_level_dept').val(dept_name);
        });

        $('#id_address').on('click', function (ev) {
            address_modal("id_address", true)
        });

        //用户授权管理部门
        $('#id_remark2').on('click', function (ev) {
            get_all_dept("#tree3", true, {{ edit_user_id }});
            $('#myDeptModal-3').modal({backdrop: 'static', keyboard: true})
        });

        Tree3DeptId = {{ managements}};

        $('#tree3').on('selected.fu.tree', function (e, result) {
            var select_list = result.selected;
            for (var i = 0; i < select_list.length; i++) {
                var value = select_list[i].value;
                if (Tree3DeptId.indexOf(value) < 0) {
                    Tree3DeptId.push(select_list[i].value)
                }
            }
        }).on('deselected.fu.tree', function (e, result) {
            var value = result.target.value;
            if (Tree3DeptId.indexOf(value) > -1) {
                Tree3DeptId.splice(contains(Tree3DeptId, value), 1);
            }
        });

        //授权部门
        function manage_dept() {
            $('#id_remark2').val(Tree3DeptId);

        }
    </script>
{% endblock %}